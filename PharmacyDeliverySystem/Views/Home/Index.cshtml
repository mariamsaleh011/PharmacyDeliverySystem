@using PharmacyDeliverySystem.Models
@{
    ViewData["Title"] = "Home";
    Layout = "_Layout";

    List<Product>? offerList = ViewBag.OffersProducts as List<Product>;
    List<Product>? topSelling = ViewBag.TopSellingProducts as List<Product>;
}

@section Head {
    <link rel="stylesheet" href="~/css/home.css" asp-append-version="true" />
}

<section class="hero hero-en">
    <div class="hero-section">
        <div class="hero-content hero-modern">
            <h1 class="headline-en">
                <span class="accent-gradient">All-in-One</span> <br />
                Platform for Your <span class="accent-gradient">Pharmacy</span>
            </h1>
            <p class="hero-subtitle">
                Browse, order, and get all pharmacy supplies delivered quickly and safely.
            </p>

            <!-- ✅ shapes الجديدة -->
            <div class="hero-shapes">
                <span class="capsule"></span>
                <span class="medical-cross"></span>
                <span class="pill"></span>
                <span class="heartbeat-line">
                    <svg viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0,30 L40,30 L50,10 L60,50 L70,20 L80,40 L90,30 L200,30"
                              stroke="currentColor"
                              stroke-width="3"
                              fill="none"
                              stroke-linecap="round"
                              style="color: var(--accent-gradient-start)" />
                    </svg>
                </span>
            </div>
            <!-- /shapes -->
        </div>
    </div>
</section>

@if (User.IsInRole("Pharmacy"))
{
    <section class="pharmacy-dashboard">
        <h3>Pharmacy Dashboard</h3>

        <div class="dashboard-buttons">

            <!-- 🔔 Total Orders + نوتفيكيشن للأوردرات الجديدة -->
            <a asp-controller="Order"
               asp-action="PharmacyOrders"
               class="btn btn-info m-2 position-relative">
                Total Orders
                <span class="badge bg-dark ms-1">
                    @(ViewBag.TotalOrders ?? 0)
                </span>

                @if ((int)(ViewBag.NewOrdersCount ?? 0) > 0)
                {
                    <span class="position-absolute top-0 start-100 translate-middle
                                                                 badge rounded-pill bg-danger">
                        @ViewBag.NewOrdersCount
                    </span>
                }
            </a>

            <!-- 👤 إضافة Owner/Admin -->
            <a asp-controller="PharmacyAuth"
               asp-action="Register"
               class="btn btn-primary m-2">
                Add Owner/Admin
            </a>

            <!-- 📦 إدارة المنتجات -->
            <a asp-controller="Admin"
               asp-action="Admin"
               class="btn btn-success m-2">
                Product Management
            </a>

            <!-- 💬 الشات + badge بعدد الشاتات الجديدة -->
            <a asp-controller="PharmacyChat"
               asp-action="Chats"
               class="btn btn-info m-2 position-relative">
                View Chats

                @if ((int)(ViewBag.NewChatsCount ?? 0) > 0)
                {
                    <span class="position-absolute top-0 start-100 translate-middle
                                                         badge rounded-pill bg-danger">
                        @ViewBag.NewChatsCount
                    </span>
                }
            </a>

            <!-- ↩️ ريتيرنز معلّقة -->
            <a asp-controller="Return"
               asp-action="Pending"
               class="btn btn-warning m-2 position-relative">
                Returns
                @if ((int)(ViewBag.PendingReturnsCount ?? 0) > 0)
                {
                    <span class="position-absolute top-0 start-100 translate-middle
                                                                 badge rounded-pill bg-danger">
                        @ViewBag.PendingReturnsCount
                    </span>
                }
            </a>
        </div>
    </section>
}

<section class="categories categories-en">
    <div class="categories-header">
        <h3>Shop by category</h3>
    </div>

    <div class="cat-strip-wrapper">
        <button type="button"
                class="cat-scroll-btn cat-scroll-prev"
                aria-label="Previous categories">
            ‹
        </button>

        <div class="cat-grid" id="catStrip">
            <a href="@Url.Action("Index", "Offers")" class="cat-card">
                <svg class="cat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="8" cy="8" r="2.5"></circle>
                    <circle cx="16" cy="16" r="2.5"></circle>
                    <line x1="6" y1="18" x2="18" y2="6"></line>
                </svg>
                <div class="cat-title">Special offers</div>
            </a>

            <a href="@Url.Action("Index", "Drugs")" class="cat-card">
                <svg class="cat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="4" y="3" width="8" height="18" rx="4"></rect>
                    <rect x="12" y="3" width="8" height="18" rx="4"></rect>
                    <line x1="8" y1="3" x2="8" y2="21"></line>
                </svg>
                <div class="cat-title">Drugs</div>
            </a>

            <a href="@Url.Action("Index", "BabyCare")" class="cat-card">
                <svg class="cat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="7" r="3"></circle>
                    <path d="M5 21c0-3.866 3.134-7 7-7s7 3.134 7 7"></path>
                </svg>
                <div class="cat-title">Baby Care</div>
            </a>

            <a href="@Url.Action("Index", "MenCare")" class="cat-card">
                <svg class="cat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="7" r="4"></circle>
                    <path d="M4 21c1.5-4 6.5-6 8-6s6.5 2 8 6"></path>
                </svg>
                <div class="cat-title">Men Care</div>
            </a>

            <a href="@Url.Action("Index", "WomenCare")" class="cat-card">
                <svg class="cat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="7" r="3"></circle>
                    <path d="M9 11h6"></path>
                    <path d="M10 14h4"></path>
                    <path d="M8 21c0-3 2-6 4-6s4 3 4 6"></path>
                </svg>
                <div class="cat-title">Women Care</div>
            </a>

            <a href="@Url.Action("Index", "Makeup")" class="cat-card">
                <svg class="cat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="6" height="14" rx="2"></rect>
                    <rect x="11" y="7" width="4" height="10" rx="1"></rect>
                    <circle cx="18" cy="15" r="2"></circle>
                </svg>
                <div class="cat-title">Makeup & Accessories</div>
            </a>

            <a href="@Url.Action("Index", "Fitness")" class="cat-card">
                <svg class="cat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="9" width="4" height="6" rx="1"></rect>
                    <rect x="18" y="9" width="4" height="6" rx="1"></rect>
                    <rect x="7" y="7" width="10" height="10" rx="2"></rect>
                </svg>
                <div class="cat-title">Fitness & Nutrition</div>
            </a>

            <a href="@Url.Action("Index", "Products")" class="cat-card">
                <svg class="cat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="7" height="7" rx="2"></rect>
                    <rect x="14" y="4" width="7" height="7" rx="2"></rect>
                    <rect x="3" y="13" width="7" height="7" rx="2"></rect>
                    <rect x="14" y="13" width="7" height="7" rx="2"></rect>
                </svg>
                <div class="cat-title">All Products</div>
            </a>
        </div>

        <button type="button"
                class="cat-scroll-btn cat-scroll-next"
                aria-label="Next categories">
            ›
        </button>
    </div>
</section>

<section class="featured-products">
    <h2 class="section-title-en">Featured products</h2>
    <p class="section-subtitle-en">Top selling items on our platform</p>

    <div class="featured-grid">
        @if (topSelling != null && topSelling.Any())
        {
            var index = 0;
            foreach (var product in topSelling)
            {
                index++;

                var hasImage = !string.IsNullOrWhiteSpace(product.ImageUrl);
                var imgSrc = hasImage
                ? product.ImageUrl
                : Url.Content("~/images/icons/product-default.svg");

                <!-- ✅ كارت Product حقيقي عشان السيرش يقرأ منه -->
                <article class="featured-card product"
                         data-product-id="@product.ProId"
                         data-name="@product.Name"
                         data-price="@product.Price">
                    @if (index == 1)
                    {
                        <span class="badge badge-hot">Most sold</span>
                    }
                    else if (index == 2)
                    {
                        <span class="badge badge-new">New</span>
                    }
                    else if (index == 3)
                    {
                        <span class="badge badge-discount">-20%</span>
                    }

                    <div class="featured-img-wrapper">
                        <img src="@imgSrc" alt="@product.Name" class="featured-img" />
                    </div>

                    <h3 class="featured-name">@product.Name</h3>
                    <p class="featured-desc">
                        @((product.Description ?? product.Dosage) ?? "Available product")
                    </p>

                    <div class="featured-footer">
                        <span class="featured-price price">
                            @product.Price.ToString("0.00 EGP")
                        </span>

                        <a href="@Url.Action("Details", "Products", new { id = product.ProId })"
                           class="btn featured-btn">
                            View details
                        </a>
                    </div>
                </article>
            }
        }
        else
        {
            <p>No featured products yet.</p>
        }
    </div>
</section>

<section class="stats-strip">
    <div class="stat-item">
        <div class="stat-number">24/7</div>
        <div class="stat-label">Customer support</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">+500</div>
        <div class="stat-label">Partner pharmacies</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">+15K</div>
        <div class="stat-label">Available products</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">+50K</div>
        <div class="stat-label">Happy customers</div>
    </div>
</section>

<section class="services-section">
    <h2 class="section-title-en">Our Featured Services</h2>

    <div class="services-grid">
        <article class="service-card">
            <div class="service-icon">🔁</div>
            <h3 class="service-title">Easy Returns & Exchanges</h3>
            <p class="service-text">
                Flexible return policy within <strong>14 days</strong> with fast product exchange options.
            </p>
        </article>

        <article class="service-card">
            <div class="service-icon">👨‍⚕️</div>
            <h3 class="service-title">Free Medical Consultations</h3>
            <p class="service-text">
                A team of professional pharmacists is available to answer your questions all day.
            </p>
        </article>

        <article class="service-card">
            <div class="service-icon">🚚</div>
            <h3 class="service-title">Fast Delivery</h3>
            <p class="service-text">
                Same-day delivery within the city with clear and affordable delivery fees.
            </p>
        </article>

        <article class="service-card">
            <div class="service-icon">🎁</div>
            <h3 class="service-title">Exclusive Offers</h3>
            <p class="service-text">
                Special discounts and exclusive deals for our customers when subscribing to our newsletter.
            </p>
        </article>
    </div>
</section>

<section class="health-tips health-tips-en">
    <h2>💡 Health tips</h2>
    <button id="dailyTipBtn" class="btn">Tip of the day</button>
    <p id="dailyTip" style="margin-top:15px;font-weight:600;"></p>
</section>

<section class="contact-section contact-en">
    <div class="contact-container">
        <div class="footer-grid">
            <div class="footer-col footer-about">
                <div class="footer-logo">
                    <img src="@(Url.Content("~/images/icons/medicine-logo.svg"))"
                         alt="PharmacyDeliverySystem logo" />
                </div>
                <p>
                    PharmacyDeliverySystem is a digital marketplace that connects
                    pharmacies and medical suppliers to easily, conveniently and
                    quickly access and receive medicine, medical supplies and
                    cosmetics at the best prices.
                </p>
            </div>

            <div class="footer-col footer-links">
                <h3>Menu</h3>
                <ul>
                    <li><a href="@Url.Action("Index", "Home")">Home</a></li>
                    <li><a href="@Url.Action("Privacy", "Home")">Privacy Policy</a></li>
                    <li><a href="@Url.Action("Contact", "Home")">Contact Us</a></li>
                    <li><a href="@Url.Action("Index", "Products")">Find a Product</a></li>
                </ul>
            </div>

            <div class="footer-col footer-contact">
                <h3>Contact us</h3>
                <p>📞 01068136166</p>
                <p>✉ help@pharmacymarts.com</p>
            </div>

            <div class="footer-col footer-connect">
                <h3>Connect with us</h3>
                <div class="footer-social">
                    <a href="#" aria-label="Facebook">📘</a>
                    <a href="#" aria-label="LinkedIn">🔗</a>
                    <a href="#" aria-label="Instagram">📸</a>
                    <a href="#" aria-label="X / Twitter">✖</a>
                </div>

                <a href="@Url.Action("Login", "CustomerAuth")"
                   class="footer-auth-btn">
                    Sign in / Sign up
                </a>
            </div>
        </div>
    </div>
</section>
